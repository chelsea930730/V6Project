<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>마이 페이지</title>
	<link th:href="@{/css/mypage.css}" rel="stylesheet" />
	<script th:src="@{/js/navbar.js}" defer></script>
	<script th:src="@{/js/mypage.js}" defer></script>
	<meta name="_csrf" th:if="${_csrf != null}" th:content="${_csrf.token}" />
	<meta name="_csrf_header" th:if="${_csrf != null}" th:content="${_csrf.headerName}" />
</head>
<body>
<div id="navbar-placeholder"></div>

<main class="mypage-container">
	<h1>마이 페이지</h1>
	<p class="sub-heading">당신이 예약한 건물을 확인하세요!</p>

	<!-- CSRF 토큰을 hidden 필드로 추가 -->
	<input type="hidden" name="_csrf" th:if="${_csrf != null}" th:value="${_csrf.token}" />

	<section class="reservation-section">
		<h2>예약 리스트</h2>

		<!-- 성공/오류 메시지 표시 -->
		<div th:if="${success}" class="alert alert-success">
			<span th:text="${success}"></span>
		</div>
		<div th:if="${error}" class="alert alert-danger">
			<span th:text="${error}"></span>
		</div>

		<table class="reservation-table">
			<thead>
			<tr>
				<th><input type="checkbox" id="selectAll"></th>
				<th>예약번호</th>
				<th>상담 날짜</th>
				<th>진행 상태</th>
				<th>문의사항</th>
				<th>채팅 바로가기</th>
				<th>예약 상세보기</th>
			</tr>
			</thead>
			<tbody>
			<tr th:each="reservation : ${activeReservations}">
				<td><input type="checkbox" th:value="${reservation.reservationId}"></td>
				<td th:text="${'NO.' + reservation.reservationId}">NO.000006</td>
				<td th:text="${#temporals.format(reservation.reservedDate, 'yyyy-MM-dd')}">2025-03-22</td>
				<td th:text="${reservation.status.name() == 'PENDING' ? '상담대기' : '-'}">상담대기</td>
				<td th:text="${reservation.message != null && #strings.length(reservation.message) > 10 ?
							#strings.substring(reservation.message, 0, 10) + '...' :
							(reservation.message != null ? reservation.message : '-')}">문의사항...</td>
				<td><button class="chat-btn">채팅하기</button></td>
				<td>
					<a th:href="@{'/mypage/reservation/' + ${reservation.reservationId}}" class="view-btn">상세보기</a>
				</td>
			</tr>
			<tr th:if="${activeReservations.isEmpty()}">
				<td colspan="7" class="empty-message">진행 중인 예약이 없습니다.</td>
			</tr>
			</tbody>
		</table>
		<button class="cancel-btn">체크된 예약 취소하기</button>
	</section>

	<section class="history-section">
		<h2>상담 완료 목록</h2>
		<table class="history-table">
			<thead>
			<tr>
				<th><input type="checkbox" id="selectAllHistory"></th>
				<th>예약번호</th>
				<th>상담 날짜</th>
				<th>진행 상태</th>
				<th>문의사항</th>
				<th>채팅로그 보기</th>
				<th>예약 상세보기</th>
			</tr>
			</thead>
			<tbody>
			<tr th:each="reservation : ${completedReservations}">
				<td><input type="checkbox" th:value="${reservation.reservationId}"></td>
				<td th:text="${'NO.' + reservation.reservationId}">NO.000001</td>
				<td th:text="${#temporals.format(reservation.reservedDate, 'yyyy-MM-dd')}">2022-10-22</td>
				<td th:text="${reservation.status.name() == 'CANCELLED' ? '상담취소' : '상담완료'}">상담취소</td>
				<td th:text="${reservation.message != null && #strings.length(reservation.message) > 10 ?
							#strings.substring(reservation.message, 0, 10) + '...' :
							(reservation.message != null ? reservation.message : '-')}">문의사항...</td>
				<td><button class="log-btn">로그보기</button></td>
				<td>
					<a th:href="@{'/mypage/reservation/' + ${reservation.reservationId}}" class="view-btn">상세보기</a>
				</td>
			</tr>
			<tr th:if="${completedReservations.isEmpty()}">
				<td colspan="7" class="empty-message">완료된 상담 내역이 없습니다.</td>
			</tr>
			</tbody>
		</table>
		<button class="delete-btn">체크한 상담 내역 삭제하기</button>
	</section>
</main>

<div id="footer-placeholder"></div>

<!-- 모달 추가 -->
<div id="imageModal" class="modal">
	<span class="close">&times;</span>
	<img class="modal-content" id="modalImage">
</div>
</body>


</html>